<script>
/* =========================
   MODAL LOGIC
========================= */

const modal = document.querySelector(".modal");
const modalContent = document.querySelector(".modal-content");
const modalImage = modal.querySelector(".modal-body img");
const modalTitle = modal.querySelector(".modal-text h2");
const modalDescription = modal.querySelector(".modal-text p");
const closeModalBtn = modal.querySelector(".close");

/* Open modal when clicking a movie image */
document.querySelectorAll(".list img, .search-modal img").forEach(img => {
  img.addEventListener("click", () => {
    modal.style.display = "flex";
    document.body.style.overflow = "hidden";

    modalImage.src = img.src;
    modalTitle.textContent = img.dataset.title || "Movie Title";
    modalDescription.textContent = img.dataset.description || "No description available.";
  });
});

/* Close modal */
function closeModal() {
  modal.style.display = "none";
  document.body.style.overflow = "";
}

closeModalBtn.addEventListener("click", closeModal);

/* Close when clicking outside content */
modal.addEventListener("click", (e) => {
  if (!modalContent.contains(e.target)) {
    closeModal();
  }
});

/* =========================
   SEARCH MODAL
========================= */

const searchBar = document.querySelector(".search-bar");
const searchModal = document.querySelector(".search-modal");
const searchInput = searchModal.querySelector("input");
const searchResults = searchModal.querySelector(".results");
const closeSearchBtn = searchModal.querySelector(".close");

/* Open search modal */
searchBar.addEventListener("focus", () => {
  searchModal.style.display = "flex";
  searchInput.focus();
  document.body.style.overflow = "hidden";
});

/* Close search modal */
closeSearchBtn.addEventListener("click", () => {
  searchModal.style.display = "none";
  document.body.style.overflow = "";
  searchInput.value = "";
  filterResults("");
});

/* Live search */
searchInput.addEventListener("input", (e) => {
  filterResults(e.target.value.toLowerCase());
});

function filterResults(query) {
  document.querySelectorAll(".list img").forEach(img => {
    const title = img.dataset.title?.toLowerCase() || "";
    img.style.display = title.includes(query) ? "block" : "none";
  });
}

/* =========================
   ESC KEY SUPPORT
========================= */

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    if (modal.style.display === "flex") closeModal();
    if (searchModal.style.display === "flex") {
      searchModal.style.display = "none";
      document.body.style.overflow = "";
    }
  }
});
</script>
